<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1, user-scalable=0">
    <title>3D Sound Simulation</title>
    <!-- Import Three.js library -->
</head>

<body style="font-size: 16px;">
    <div>
        <input id="txtAudioURL" type="text" title="Audio URL"
               value="https://martineaoun.com/3DSoundReflection/c3_major_scale_piano.wav"
               style="width: 100%;height: 30px;font-size: 16px !important;">
        <audio id="music" preload="auto" style="display: none" crossOrigin="anonymous">
            <source id="sourceAudio" type="audio/mpeg">
        </audio>
        <div id="overlay">
            <button id="startButton" style="width: 100%;height: 60px;">Play</button>
        </div>
    </div>
    <script type="module">
        import * as THREE from 'https://unpkg.com/three@0.120.0/build/three.module.js';
        import { OrbitControls } from 'https://unpkg.com/three@0.120.0/examples/jsm/controls/OrbitControls.js';
        import { PositionalAudioHelper } from 'https://unpkg.com/three@0.120.0/examples/jsm/helpers/PositionalAudioHelper.js';
        import { GLTFLoader } from 'https://unpkg.com/three@0.120.0/examples/jsm/loaders/GLTFLoader.js';
        import { simplex } from 'https://martineaoun.com/3DSoundReflection/simplex-noise.js';

        const noise = new simplex.SimplexNoise();

        var roomCubeDimension = 20;
        var boomBoxPositionX = 0;
        var boomBoxPositionY = -(roomCubeDimension / 2) + 1;
        var boomBoxPositionZ = 0;

        let analyser;
        let dataArray;
        let group;
        let plane;
        let plane2;
        let ball;
        let particleSystem; // Variable to hold the particle system
        let isSoundPlaying = false;


        // Initialize Three.js scene, camera, and renderer
        let scene = new THREE.Scene();
        scene.background = new THREE.Color('gainsboro');

        let camera = new THREE.PerspectiveCamera(30, window.innerWidth / window.innerHeight);
        camera.position.set(0, 0, 70);
        camera.lookAt(scene.position);

        group = new THREE.Group();

        var renderer = new THREE.WebGLRenderer({ alpha: true, antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setAnimationLoop(animationLoop);
        renderer.shadowMap.enabled = true;
        document.body.appendChild(renderer.domElement);

        window.addEventListener('resize', onWindowResize);

        var controls = new OrbitControls(camera, renderer.domElement);
        controls.enableDamping = true;

        var light = new THREE.DirectionalLight('white', 1);
        light.position.set(1, 1, 1);
        scene.add(light);

        // Create a grid helper
        let gridHelper = new THREE.GridHelper(roomCubeDimension, roomCubeDimension, 0xc1c1c1, 0xc1c1c1);
        var gridHelperPositionX = 0;
        var gridHelperPositionY = -roomCubeDimension / 2;
        var gridHelperPositionZ = 0;

        gridHelper.position.set(gridHelperPositionX, gridHelperPositionY, gridHelperPositionZ);
        // Add the grid helper to the scene
        scene.add(gridHelper);

        var geometry = new THREE.BoxGeometry(roomCubeDimension, roomCubeDimension, 0.4),
        material = new THREE.MeshLambertMaterial({ color: 'royalblue', transparent: true });

        var wall1 = new THREE.Mesh(geometry, material.clone());
        wall1.position.z = roomCubeDimension / 2;

        var wall2 = new THREE.Mesh(geometry, material.clone());
        wall2.rotation.y = Math.PI;
        wall2.position.z = -roomCubeDimension / 2;

        var wall3 = new THREE.Mesh(geometry, material.clone());
        wall3.rotation.y = Math.PI / 2;
        wall3.position.x = roomCubeDimension / 2;

        var wall4 = new THREE.Mesh(geometry, material.clone());
        wall4.rotation.y = -Math.PI / 2;
        wall4.position.x = -roomCubeDimension / 2;

        var wall5 = new THREE.Mesh(geometry, material.clone());
        wall5.rotation.x = Math.PI / 2;
        wall5.position.y = -roomCubeDimension / 2;

        var wall6 = new THREE.Mesh(geometry, material.clone());
        wall6.rotation.x = -Math.PI / 2;
        wall6.position.y = roomCubeDimension / 2;

        var walls = [wall1, wall2, wall3, wall4, wall5, wall6];

        scene.add(...walls);

        var v = new THREE.Vector3(),
        u = new THREE.Vector3();

        function onWindowResize() {
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(window.innerWidth, window.innerHeight);
        }

        function animationLoop(t) {
        controls.update();

        for (var wall of walls) {
        wall.getWorldDirection(v);
        camera.getWorldDirection(u);

        wall.material.opacity = 2 * v.dot(u); 		// soft
        //wall.visible = v.dot(u) > 0; 					// hard
        }

        //light.position.copy(camera.position);
        renderer.render(scene, camera);
        }

        const startButton = document.getElementById('startButton');
        startButton.addEventListener('click', init);

        function init() {

        const sourceAudio = document.getElementById('sourceAudio');
        const audioURL = document.getElementById('txtAudioURL');

        const overlay = document.getElementById('overlay');
        overlay.remove();
        audioURL.disabled = true;

        const listener = new THREE.AudioListener();
        camera.add(listener);

        sourceAudio.src = audioURL.value;

        const positionalAudio = new THREE.PositionalAudio(listener);

        var distanceValue = roomCubeDimension;
        var coneInnerAngle = 180;
        var coneOuterAngle = 360;
        var coneOuterGain = 0.1;
        var range = 0.1;
        const helper = new PositionalAudioHelper(positionalAudio, range);

        const loader = new THREE.AudioLoader();
        loader.load(audioURL.value, (buffer) => {
        setTimeout(() => {
        positionalAudio.setBuffer(buffer);
        //positionalAudio.setLoop(false);
        positionalAudio.setVolume(1.0);
        positionalAudio.setRefDistance(distanceValue); // the reference distance for reducing volume as the audio source moves further from the listener – i.e. the distance at which the volume reduction starts taking effect.
        positionalAudio.setDirectionalCone(coneInnerAngle, coneOuterAngle, coneOuterGain);
        positionalAudio.add(helper);

        const gltfLoader = new GLTFLoader();
        gltfLoader.load('https://martineaoun.com/3DSoundReflection/BoomBox.glb', function (gltf) {

        const boomBox = gltf.scene;

        boomBox.position.set(boomBoxPositionX, boomBoxPositionY, boomBoxPositionZ); // Position at the center of the room

        var boomBoxScale = 100;
        boomBox.scale.set(boomBoxScale, boomBoxScale, boomBoxScale);
        boomBox.traverse(function (object) {

        if (object.isMesh) {
        object.material.envMap = scene;
        object.geometry.rotateY(- Math.PI);
        object.castShadow = true;
        }

        });

        boomBox.add(positionalAudio);
        scene.add(boomBox);

        setTimeout(() => {
        positionalAudio.play();
        isSoundPlaying = true;

        // Stop the animation loop when the sound finishes
        positionalAudio.onEnded = function () {
        isSoundPlaying = false;
        };

        var audioAnalyser = new THREE.AudioAnalyser(positionalAudio);
        analyser = audioAnalyser.analyser;
        analyser.fftSize = 1024; // https://developer.mozilla.org/en-US/docs/Web/API/AnalyserNode/fftSize

        var bufferLength = analyser.frequencyBinCount;
        dataArray = new Uint8Array(bufferLength);

        var planeGeometry = new THREE.PlaneGeometry(800, 800, 20, 20);
        var planeMaterial = new THREE.MeshLambertMaterial({
        color: 0x6904ce,
        wireframe: true,
        opacity: 0.5
        });

        plane = new THREE.Mesh(planeGeometry, planeMaterial);
        plane.rotation.x = -0.5 * Math.PI;
        plane.position.set(0, 30, 0);
        group.add(plane);

        plane2 = new THREE.Mesh(planeGeometry, planeMaterial);
        plane2.rotation.x = -0.5 * Math.PI;
        plane2.position.set(0, -30, 0);
        group.add(plane2);

        var icosahedronGeometry = new THREE.IcosahedronGeometry(10, 4);
        var lambertMaterial = new THREE.MeshLambertMaterial({
        color: 0xff00ee,
        wireframe: true,
        opacity: 0.9,
        side: THREE.DoubleSide,
        vertexColors: true,
        reflectivity: 1,
        refractionRatio: 1
        });

        ball = new THREE.Mesh(icosahedronGeometry, lambertMaterial);
        ball.position.set(0, 0, 0);
        group.add(ball);

        var ambientLight = new THREE.AmbientLight(0xaaaaaa);
        scene.add(ambientLight);

        var spotLight = new THREE.SpotLight(0xffffff);
        spotLight.intensity = 0.9;
        spotLight.position.set(-10, 40, 20);
        spotLight.lookAt(ball);
        spotLight.castShadow = true;
        scene.add(spotLight);

        scene.add(group);

        var particleCount = 1000;
        var particles = new THREE.Geometry();
        var bufferSpace = 5; // Add buffer space between particles and room boundaries

        for (var p = 0; p < particleCount; p++) {
        var x = (Math.random() - 0.5) * (roomCubeDimension - bufferSpace * 2); // Spread particles uniformly within room width with buffer space
        var y = (Math.random() - 0.5) * (roomCubeDimension - bufferSpace * 2); // Spread particles uniformly within room height with buffer space
        var z = (Math.random() - 0.5) * (roomCubeDimension - bufferSpace * 2); // Spread particles uniformly within room depth with buffer space

        var particle = new THREE.Vector3(x, y, z);

        particles.vertices.push(particle);
        }

        var particleMaterial = new THREE.PointsMaterial({
        color: 'red',
        size: 0.2
        });

        particleSystem = new THREE.Points(particles, particleMaterial);
        scene.add(particleSystem);

        animate();
        }, 1000);

        });

        }, 1000);
        });
        }

        // Render loop
        function animate() {
        if (isSoundPlaying) {
        analyser.getByteFrequencyData(dataArray);

        var lowerHalfArray = dataArray.slice(0, (dataArray.length / 2) - 1);
        var upperHalfArray = dataArray.slice((dataArray.length / 2) - 1, dataArray.length - 1);

        var overallAvg = avg(dataArray);
        var lowerMax = max(lowerHalfArray);
        var lowerAvg = avg(lowerHalfArray);
        var upperMax = max(upperHalfArray);
        var upperAvg = avg(upperHalfArray);

        var lowerMaxFr = lowerMax / lowerHalfArray.length;
        var lowerAvgFr = lowerAvg / lowerHalfArray.length;
        var upperMaxFr = upperMax / upperHalfArray.length;
        var upperAvgFr = upperAvg / upperHalfArray.length;

        makeRoughGround(plane, modulate(upperAvgFr, 0, 1, 0.5, 4));
        makeRoughGround(plane2, modulate(lowerMaxFr, 0, 1, 0.5, 4));

        makeRoughBall(ball, modulate(Math.pow(lowerMaxFr, 0.8), 0, 1, 0, 8), modulate(upperAvgFr, 0, 1, 0, 4));

        //// Update the visualization color based on the average frequency data
        //const averageFrequency = getAverageFrequency(dataArray);
        //const newColor = new THREE.Color().setHSL(averageFrequency / 255, 1, 0.5); // Adjust color based on average frequency
        //ball.material.color.copy(newColor);
        // Method 1: Change color based on dominant frequency and note
        var dominantFrequency = getDominantFrequency(dataArray);
        var note = frequencyToNote(dominantFrequency);
        var color = noteToColor(note);
        //ball.material.color.set(color);
        ball.material.color.setHex(color);

        //group.rotation.y += 0.005;

        // Check if the dataArray contains non-zero values
        const hasAudioData = dataArray.some(value => value > 0);

        // Only update particle positions if there is audio data
        if (hasAudioData) {
        // Update particle positions based on the audio data
        particleSystem.geometry.vertices.forEach((particle, i) => {
        var frequencyIndex = Math.floor(i * (dataArray.length / particleSystem.geometry.vertices.length));
        var frequencyValue = dataArray[frequencyIndex];
        var offset = roomCubeDimension;
        var amp = 0.5;
        var time = window.performance.now();
        var rf = 0.00001;
        var x = (Math.random() - 0.5) * offset; // Randomize position within adjusted offset
        var y = (Math.random() - 0.5) * offset; // Randomize position within adjusted offset
        var z = (Math.random() - 0.5) * offset; // Randomize position within adjusted offset

        // Adjust damping factor based on frequencyValue
        var dampingFactor = 1 - (frequencyValue / 255); // Lower frequency values will result in higher damping factors

        // Move particles towards the random position
        particle.x += (x - particle.x) * dampingFactor;
        particle.y += (y - particle.y) * dampingFactor;
        particle.z += (z - particle.z) * dampingFactor;

        // Adjust particle size based on frequencyValue
        var minSize = 0; // Minimum size of particles
        var maxSize = 10; // Maximum size of particles
        var particleSize = minSize + (maxSize - minSize) * (frequencyValue / 255);

        particle.size = particleSize;
        });
        particleSystem.geometry.verticesNeedUpdate = true;
        }
        }
        renderer.render(scene, camera);
        requestAnimationFrame(animate);
        }

        function makeRoughBall(mesh, bassFr, treFr) {
        mesh.geometry.vertices.forEach(function (vertex, i) {
        var offset = mesh.geometry.parameters.radius;
        var amp = 7;
        var time = window.performance.now();
        vertex.normalize();
        var rf = 0.00001;
        var distance = (offset + bassFr) + noise.noise3D(vertex.x + time * rf * 7, vertex.y + time * rf * 8, vertex.z + time * rf * 9) * amp * treFr;
        vertex.multiplyScalar(distance);
        });
        mesh.geometry.verticesNeedUpdate = true;
        mesh.geometry.normalsNeedUpdate = true;
        mesh.geometry.computeVertexNormals();
        mesh.geometry.computeFaceNormals();
        }

        function makeRoughGround(mesh, distortionFr) {
        mesh.geometry.vertices.forEach(function (vertex, i) {
        var amp = 2;
        var time = Date.now();
        var distance = (noise.noise2D(vertex.x + time * 0.0003, vertex.y + time * 0.0001) + 0) * distortionFr * amp;
        vertex.z = distance;
        });
        mesh.geometry.verticesNeedUpdate = true;
        mesh.geometry.normalsNeedUpdate = true;
        mesh.geometry.computeVertexNormals();
        mesh.geometry.computeFaceNormals();
        }

        function fractionate(val, minVal, maxVal) {
        return (val - minVal) / (maxVal - minVal);
        }

        function modulate(val, minVal, maxVal, outMin, outMax) {
        var fr = fractionate(val, minVal, maxVal);
        var delta = outMax - outMin;
        return outMin + (fr * delta);
        }

        function avg(arr) {
        var total = arr.reduce(function (sum, b) { return sum + b; });
        return (total / arr.length);
        }

        function max(arr) {
        return arr.reduce(function (a, b) { return Math.max(a, b); })
        }

        // Function to calculate the average frequency from frequency data
        function getAverageFrequency(frequencyData) {
        let sum = 0;
        for (let i = 0; i < frequencyData.length; i++) {
        sum += frequencyData[i];
        }
        return sum / frequencyData.length;
        }

        // Function to get the dominant frequency from the frequency data
        function getDominantFrequency(dataArray) {
        let maxAmplitude = -Infinity;
        let dominantIndex = 0;
        for (let i = 0; i < dataArray.length; i++) {
        if (dataArray[i] > maxAmplitude) {
        maxAmplitude = dataArray[i];
        dominantIndex = i;
        }
        }
        const sampleRate = analyser.context.sampleRate; // Use actual sample rate
        const fftSize = analyser.fftSize;
        const dominantFrequency = (dominantIndex * sampleRate) / fftSize;
        return dominantFrequency;
        }

        // Function to map frequency to musical note
        function frequencyToNote(frequency) {
        const noteFrequencies = [
        { note: 'C', frequency: 16.35 },
        { note: 'C#', frequency: 17.32 },
        { note: 'D', frequency: 18.35 },
        { note: 'D#', frequency: 19.45 },
        { note: 'E', frequency: 20.60 },
        { note: 'F', frequency: 21.83 },
        { note: 'F#', frequency: 23.12 },
        { note: 'G', frequency: 24.50 },
        { note: 'G#', frequency: 25.96 },
        { note: 'A', frequency: 27.50 },
        { note: 'A#', frequency: 29.14 },
        { note: 'B', frequency: 30.87 },
        { note: 'C1', frequency: 32.70 },
        { note: 'C#1/Db1', frequency: 34.65 },
        { note: 'D1', frequency: 36.71 },
        { note: 'D#1/Eb1', frequency: 38.89 },
        { note: 'E1', frequency: 41.20 },
        { note: 'F1', frequency: 43.65 },
        { note: 'F#1/Gb1', frequency: 46.25 },
        { note: 'G1', frequency: 49.00 },
        { note: 'G#1/Ab1', frequency: 51.91 },
        { note: 'A1', frequency: 55.00 },
        { note: 'A#1/Bb1', frequency: 58.27 },
        { note: 'B1', frequency: 61.74 },
        { note: 'C2', frequency: 65.41 },
        { note: 'C#2/Db2', frequency: 69.30 },
        { note: 'D2', frequency: 73.42 },
        { note: 'D#2/Eb2', frequency: 77.78 },
        { note: 'E2', frequency: 82.41 },
        { note: 'F2', frequency: 87.31 },
        { note: 'F#2/Gb2', frequency: 92.50 },
        { note: 'G2', frequency: 98.00 },
        { note: 'G#2/Ab2', frequency: 103.83 },
        { note: 'A2', frequency: 110.00 },
        { note: 'A#2/Bb2', frequency: 116.54 },
        { note: 'B2', frequency: 123.47 },
        { note: 'C3', frequency: 130.81 },
        { note: 'C#3/Db3', frequency: 138.59 },
        { note: 'D3', frequency: 146.83 },
        { note: 'D#3/Eb3', frequency: 155.56 },
        { note: 'E3', frequency: 164.81 },
        { note: 'F3', frequency: 174.61 },
        { note: 'F#3/Gb3', frequency: 185.00 },
        { note: 'G3', frequency: 196.00 },
        { note: 'G#3/Ab3', frequency: 207.65 },
        { note: 'A3', frequency: 220.00 },
        { note: 'A#3/Bb3', frequency: 233.08 },
        { note: 'B3', frequency: 246.94 },
        { note: 'C4', frequency: 261.63 },
        { note: 'C#4/Db4', frequency: 277.18 },
        { note: 'D4', frequency: 293.66 },
        { note: 'D#4/Eb4', frequency: 311.13 },
        { note: 'E4', frequency: 329.63 },
        { note: 'F4', frequency: 349.23 },
        { note: 'F#4/Gb4', frequency: 369.99 },
        { note: 'G4', frequency: 392.00 },
        { note: 'G#4/Ab4', frequency: 415.30 },
        { note: 'A4', frequency: 440.00 },
        { note: 'A#4/Bb4', frequency: 466.16 },
        { note: 'B4', frequency: 493.88 },
        { note: 'C5', frequency: 523.25 },
        { note: 'C#5/Db5', frequency: 554.37 },
        { note: 'D5', frequency: 587.33 },
        { note: 'D#5/Eb5', frequency: 622.25 },
        { note: 'E5', frequency: 659.25 },
        { note: 'F5', frequency: 698.46 },
        { note: 'F#5/Gb5', frequency: 739.99 },
        { note: 'G5', frequency: 783.99 },
        { note: 'G#5/Ab5', frequency: 830.61 },
        { note: 'A5', frequency: 880.00 },
        { note: 'A#5/Bb5', frequency: 932.33 },
        { note: 'B5', frequency: 987.77 },
        { note: 'C6', frequency: 1046.50 },
        { note: 'C#6/Db6', frequency: 1108.73 },
        { note: 'D6', frequency: 1174.66 },
        { note: 'D#6/Eb6', frequency: 1244.51 },
        { note: 'E6', frequency: 1318.51 },
        { note: 'F6', frequency: 1396.91 },
        { note: 'F#6/Gb6', frequency: 1479.98 },
        { note: 'G6', frequency: 1567.98 },
        { note: 'G#6/Ab6', frequency: 1661.22 },
        { note: 'A6', frequency: 1760.00 },
        { note: 'A#6/Bb6', frequency: 1864.66 },
        { note: 'B6', frequency: 1975.53 },
        { note: 'C7', frequency: 2093.00 },
        { note: 'C#7/Db7', frequency: 2217.46 },
        { note: 'D7', frequency: 2349.32 },
        { note: 'D#7/Eb7', frequency: 2489.02 },
        { note: 'E7', frequency: 2637.02 },
        { note: 'F7', frequency: 2793.83 },
        { note: 'F#7/Gb7', frequency: 2959.96 },
        { note: 'G7', frequency: 3135.96 },
        { note: 'G#7/Ab7', frequency: 3322.44 },
        { note: 'A7', frequency: 3520.00 },
        { note: 'A#7/Bb7', frequency: 3729.31 },
        { note: 'B7', frequency: 3951.07 },
        { note: 'C8', frequency: 4186.01 },
        // Extend this array as needed for more octaves
        ];

        let closestNote = noteFrequencies[0].note;
        let minDifference = Math.abs(frequency - noteFrequencies[0].frequency);

        for (let i = 1; i < noteFrequencies.length; i++) {
        const difference = Math.abs(frequency - noteFrequencies[i].frequency);
        if (difference < minDifference) {
        closestNote = noteFrequencies[i].note;
        minDifference = difference;
        }
        }
        return closestNote;
        }

        // Function to map musical note to color
        function noteToColor(note) {
        const noteColors = {
        'C': 0xff0000,   // Red
        'C#': 0xff8000,  // Orange
        'D': 0xffff00,   // Yellow
        'D#': 0x80ff00,  // Lime
        'E': 0x00ff00,   // Green
        'F': 0x00ff80,   // Aqua
        'F#': 0x00ffff,  // Cyan
        'G': 0x0080ff,   // Sky Blue
        'G#': 0x0000ff,  // Blue
        'A': 0x8000ff,   // Purple
        'A#': 0xff00ff,  // Magenta
        'B': 0xff0080,   // Pink
        'C1': 0xff0000,    // Red
        'C#1/Db1': 0xff4000,  // Orange Red
        'D1': 0xff8000,    // Orange
        'D#1/Eb1': 0xffbf00,  // Yellow Orange
        'E1': 0xffff00,    // Yellow
        'F1': 0xbfff00,    // Yellow Green
        'F#1/Gb1': 0x80ff00,  // Lime Green
        'G1': 0x40ff00,    // Light Green
        'G#1/Ab1': 0x00ff00,  // Green
        'A1': 0x00ff40,    // Spring Green
        'A#1/Bb1': 0x00ff80,  // Aqua
        'B1': 0x00ffff,    // Cyan
        'C2': 0x0080ff,    // Sky Blue
        'C#2/Db2': 0x0040ff,  // Dodger Blue
        'D2': 0x0000ff,    // Blue
        'D#2/Eb2': 0x4000ff,  // Purple Blue
        'E2': 0x8000ff,    // Purple
        'F2': 0xbf00ff,    // Magenta
        'F#2/Gb2': 0xff00ff,  // Fuchsia
        'G2': 0xff00bf,    // Deep Pink
        'G#2/Ab2': 0xff0080,  // Hot Pink
        'A2': 0xff0040,    // Coral
        'A#2/Bb2': 0xff0000,  // Red
        'B2': 0xff4000,    // Orange Red
        'C3': 0xff8000,    // Orange
        'C#3/Db3': 0xffbf00,  // Yellow Orange
        'D3': 0xffff00,    // Yellow
        'D#3/Eb3': 0xbfff00,  // Yellow Green
        'E3': 0x80ff00,    // Lime Green
        'F3': 0x40ff00,    // Light Green
        'F#3/Gb3': 0x00ff00,  // Green
        'G3': 0x00ff40,    // Spring Green
        'G#3/Ab3': 0x00ff80,  // Aqua
        'A3': 0x00ffff,    // Cyan
        'A#3/Bb3': 0x0080ff,  // Sky Blue
        'B3': 0x0040ff,    // Dodger Blue
        'C4': 0x0000ff,    // Blue
        'C#4/Db4': 0x4000ff,  // Purple Blue
        'D4': 0x8000ff,    // Purple
        'D#4/Eb4': 0xbf00ff,  // Magenta
        'E4': 0xff00ff,    // Fuchsia
        'F4': 0xff00bf,    // Deep Pink
        'F#4/Gb4': 0xff0080,  // Hot Pink
        'G4': 0xff0040,    // Coral
        'G#4/Ab4': 0xff0000,  // Red
        'A4': 0xff4000,    // Orange Red
        'A#4/Bb4': 0xff8000,  // Orange
        'B4': 0xffbf00,    // Yellow Orange
        'C5': 0xffff00,    // Yellow
        'C#5/Db5': 0xbfff00,  // Yellow Green
        'D5': 0x80ff00,    // Lime Green
        'D#5/Eb5': 0x40ff00,  // Light Green
        'E5': 0x00ff00,    // Green
        'F5': 0x00ff40,    // Spring Green
        'F#5/Gb5': 0x00ff80,  // Aqua
        'G5': 0x00ffff,    // Cyan
        'G#5/Ab5': 0x0080ff,  // Sky Blue
        'A5': 0x0040ff,    // Dodger Blue
        'A#5/Bb5': 0x0000ff,  // Blue
        'B5': 0x4000ff,    // Purple Blue
        'C6': 0x8000ff,    // Purple
        'C#6/Db6': 0xbf00ff,  // Magenta
        'D6': 0xff00ff,    // Fuchsia
        'D#6/Eb6': 0xff00bf,  // Deep Pink
        'E6': 0xff0080,    // Hot Pink
        'F6': 0xff0040,    // Coral
        'F#6/Gb6': 0xff0000,  // Red
        'G6': 0xff4000,    // Orange Red
        'G#6/Ab6': 0xff8000,  // Orange
        'A6': 0xffbf00,    // Yellow Orange
        'A#6/Bb6': 0xffff00,  // Yellow
        'B6': 0xbfff00,    // Yellow Green
        'C7': 0x80ff00,    // Lime Green
        'C#7/Db7': 0x40ff00,  // Light Green
        'D7': 0x00ff00,    // Green
        'D#7/Eb7': 0x00ff40,  // Spring Green
        'E7': 0x00ff80,    // Aqua
        'F7': 0x00ffff,    // Cyan
        'F#7/Gb7': 0x0080ff,  // Sky Blue
        'G7': 0x0040ff,    // Dodger Blue
        'G#7/Ab7': 0x0000ff,  // Blue
        'A7': 0x4000ff,    // Purple Blue
        'A#7/Bb7': 0x8000ff,  // Purple
        'B7': 0xbf00ff,    // Magenta
        'C8': 0xff00ff,     // Fuchsia
        '': 0xffffff // White
        };
        return noteColors[note] || 0xffffff; // Default to white if note not found
        }

    </script>
</body>

</html>